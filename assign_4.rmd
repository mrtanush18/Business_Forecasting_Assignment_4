---
title: "HW 4"
author: "Tanush"
email : "ts1333@scarletmail.rutgers.edu"
date: "10/06/2024"
output: html_document
---

```{r}
# Set a CRAN mirror
options(repos = c(CRAN = "https://cran.r-project.org"))

install.packages("readxl")
library(readxl)
library(dplyr)
library(fpp)
library(fpp2)
library(TTR)

# Importing the file
sales_data <- read_excel("C:\\Users\\tanus\\Downloads\\BF assign 4\\WalmartSalesData.xlsx")

# sort data by date in ascending order
sales_data$Date <- as.Date(sales_data$Date, format="%d-%m-%Y")
sales_data <- sales_data %>% arrange(Date)
print(sales_data)

# Inspect the structure of the dataset
str(sales_data)

# Check unique values in 'gross income' to identify non-numeric entries
unique(sales_data$gross_income)

# Remove non-numeric characters (e.g., dollar signs, commas)
sales_data$gross_income <- gsub("[^0-9.]", "", sales_data$gross_income)

# Verify the cleaning
unique(sales_data$gross_income)

# Convert 'gross income' to numeric
sales_data$gross_income <- as.numeric(sales_data$gross_income)

# Check for NA values introduced by non-numeric elements
sum(is.na(sales_data$gross_income))

# Remove rows with NA values in 'gross income'
sales_data <- sales_data[!is.na(sales_data$gross_income), ]

# Verify the conversion
summary(sales_data$gross_income)

# Convert 'gross_income' to a time series object
sales_data <- ts(sales_data$gross_income, start=c(2019,1), frequency=48)
plot(sales_data)

acf(sales_data)

install.packages("forecast")
library(forecast)

# Forecast future values, 5 is the forecasting period
mean_forecast <- meanf(sales_data, h = 5)

# Plot the forecasted values
plot(mean_forecast)

# acf(mean_forecast)

# Naive forecast
naive_forecast <- naive(sales_data,5)
plot(naive_forecast)

# Random Walk
rwf_forecast <- rwf(sales_data,5)
rwf_forecast <- rwf(sales_data,5, drift=TRUE)
plot(rwf_forecast)

# Seasonal Naive
snaive_forecast <- snaive(sales_data,5)
plot(snaive_forecast)

# Plot combined graph
plot(mean_forecast)
lines(naive_forecast$mean,col="red")

# what other attributes are there?
attributes(naive_forecast)

lines(rwf_forecast$mean,col="green")
lines(snaive_forecast$mean,col="black")
lines(naive_forecast$mean,col="red")

# now do a drift with RWF
rwf_forecast <- rwf(sales_data,5, drift=TRUE)
lines(rwf_forecast$mean,col="green")

# moving averages
MA5_forecast <- ma(sales_data,order=5)
lines(MA5_forecast,col="Pink")
plot(MA5_forecast)

MA9_forecast <- ma(sales_data,order=9)
lines(MA9_forecast,col="Blue")
plot(MA9_forecast)

# Holts Winters and SSE
ets(sales_data)

# lets do complete holt winters
HoltWinters(sales_data)

#Do a SSE
HoltWinters(sales_data,beta=FALSE,gamma=FALSE)
SSE_Simple <- HoltWinters(sales_data,beta=FALSE,gamma=FALSE)
attributes(SSE_Simple)
plot(SSE_Simple)
SSE_Simple$SSE
SSE_Simple$fitted

# Lets do SSE with Trend
SSE_Trend <- HoltWinters(sales_data,gamma=FALSE)
plot(SSE_Trend)
SSE_Trend
attributes(SSE_Trend)
SSE_Trend$SSE  # check the residual error magnitude

# now Holts Winters
SSE_Winters <- HoltWinters(sales_data)
SSE_Winters$SSE
plot(SSE_Winters)

# ETS
ets(sales_data)
ets_forecast <- ets(sales_data)
attributes(ets)
attributes(ets_forecast)
ets_forecast$mse

# how do we forecast now!!
forecast.ets(ets_forecast, h=5)
forecast_ets <- forecast.ets(ets_forecast, h=5)
plot(forecast_ets)

# find accuracy
accuracy(naive_forecast)
accuracy(mean_forecast)
accuracy(snaive_forecast)
accuracy(ets_forecast)